<div class="container">
  <div class="row my-2">
    <div class="col">
      <div class="d-flex justify-content-start">
        <h1>Factura</h1>
      </div>
    </div>
    <div class="col">
      <div class="d-flex justify-content-end">
        <div>
          <strong>Fecha:</strong>
          <p-calendar [locale]='es' [(ngModel)]='fecha'></p-calendar>
        </div>
      </div>
    </div>
  </div>
  <div class="row my-2">
    <div class="col-12">
      <div class="d-flex justify-content-end">
        <p-selectButton [options]="opcionesTipoFactura" [(ngModel)]="tipoFactura"></p-selectButton>
      </div>
    </div>
  </div>
  <hr>
  <div class="row my-2">
    <div class="col">
      <h5>Descripción</h5>
      <app-click-to-edit [value]=descripcion (onSave)="actualizarDescripcion($event)"></app-click-to-edit>
    </div>
  </div>
  <hr>
  <div class="row my-2">
    <div class="col col-md-8">
      <h5>Detalle</h5>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Cantidad</th>
              <th>Descripción</th>
              <th>Precio unitario</th>
              <th>Total</th>
              <th>Opciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of detalleFactura; let indice=index">
              <td scope="row">
                <app-click-to-edit [regex]=regexNumero field='cantidad' value={{item.cantidad}} (onSave)="actualizarValorTotalFactura($event, indice)"></app-click-to-edit>
              </td>
              <td>
                <app-click-to-edit value={{item.descripcion}} field='descripcion' (onSave)="actualizarValorTotalFactura($event, indice)"></app-click-to-edit>
              </td>
              <td>
                <app-click-to-edit value={{item.precioUnitario}} field='precioUnitario' (onSave)="actualizarValorTotalFactura($event, indice)"
                  [regex]=regexFlotante>{{item.precioUnitario | currency:'USD'}}</app-click-to-edit>
              </td>
              <td>{{item.cantidad * item.precioUnitario | currency:'USD' }}</td>
              <td>
                <button class="btn btn-danger btn-sm btn-block" (click)="eliminarItemDetalleFactura(indice)">Borrar</button>
              </td>
            </tr>
            <tr>
              <td scope="row"></td>
              <td></td>
              <td>Total</td>
              <td>{{totalFactura | currency:'USD'}}</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col col-md-4">
      <form [formGroup]='formularioDetalleFactura' (ngSubmit)="agregarItemADetalleFactura(formularioDetalleFactura.value)">
        <div class="form-group">
          <label class="col-form-label">Cantidad</label>
          <input class="form-control" formControlName="cantidad" type="text" pInputText/>
          <span hidden translate>Cantidad</span>
          <small [hidden]="formularioDetalleFactura.controls.cantidad.valid || formularioDetalleFactura.controls.cantidad.untouched"
            class="text-danger" translate>
            Cantidad es requerido
          </small>
        </div>
        <div class="form-group">
          <label class="col-form-label">Descripción</label>
          <input class="form-control" formControlName="descripcion" type="text" pInputText/>
          <span hidden translate>Descripción</span>
          <small [hidden]="formularioDetalleFactura.controls.descripcion.valid || formularioDetalleFactura.controls.descripcion.untouched"
            class="text-danger" translate>
            Descripción es requerido
          </small>
        </div>
        <div class="form-group">
          <label class="col-form-label">Precio unitario</label>
          <input class="form-control" formControlName="precioUnitario" type="text" pInputText/>
          <span hidden translate>Precio unitario</span>
          <small [hidden]="formularioDetalleFactura.controls.precioUnitario.valid || formularioDetalleFactura.controls.precioUnitario.untouched"
            class="text-danger" translate>
            Precio unitario es requerido
          </small>
        </div>
        <button type='submit' class="btn btn-info btn-sm btn-block" [disabled]="formularioDetalleFactura.invalid">Agregar</button>
      </form>
    </div>
  </div>
  <div class="row my-2">
    <div class="col">
      <h5>Etiquetas</h5>
      <p-chips [(ngModel)]="etiquetas"></p-chips>
    </div>
  </div>
  <hr>
  <div class="row my-2">
    <div class="col">
      <h5>Imagen</h5>
      <p-fileUpload #form mode="basic" auto="true" chooseLabel="Subir imagen" accept="image/*" customUpload="true" (uploadHandler)="guardarImagenFactura($event, form)"></p-fileUpload>
      <div class="d-flex justify-content-center img-container contenedor-imagen">
        <img [src]="imagenFacturaUrl" class="img-fluid" alt="Factura">
      </div>
    </div>
  </div>
  <hr>
  <div class="row">
    <div class="col d-flex justify-content-center">
      <button class="btn btn-success" [disabled]="isFacturaInvalida()" (click)="guardarFactura()">Guardar</button>
    </div>
  </div>
</div>
